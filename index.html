<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Living Intelligence Research Agent - Redefining Intelligence</title>
    <!-- PDF Generation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Poppins Font Integration -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f0f6fd 0%, #9daaec 100%);
            min-height: 100vh;
            color: #3e3a44;
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }
        
        .glass {
            background: rgba(240, 246, 253, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(111, 154, 76, 0.2);
            box-shadow: 0 8px 32px rgba(71, 72, 95, 0.15);
        }
        
        .header {
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .header h1 {
            font-size: 2.5em;
            color: #47485f;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            color: #6f9a4c;
            font-size: 1.1em;
            font-style: italic;
            font-weight: 400;
        }
        
        .search-section {
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .species-input {
            padding: 15px;
            font-size: 16px;
            border: 2px solid #9daaec;
            border-radius: 12px;
            background: #f0f6fd;
            color: #3e3a44;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
        }
        
        .species-input:focus {
            outline: none;
            border-color: #6f9a4c;
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(111, 154, 76, 0.2);
        }
        
        .options-section {
            margin: 20px 0;
            text-align: left;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 15px 0;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #47485f;
            font-weight: 500;
        }
        
        .checkbox-item input[type="checkbox"] {
            transform: scale(1.2);
            accent-color: #6f9a4c;
        }
        
        .research-btn {
            background: linear-gradient(135deg, #6f9a4c, #4e6440);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(111, 154, 76, 0.3);
            margin: 20px 10px;
        }
        
        .research-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(111, 154, 76, 0.4);
            background: linear-gradient(135deg, #4e6440, #6f9a4c);
        }
        
        .results-container {
            padding: 30px;
            margin: 20px 0;
            position: relative;
            background: rgba(255, 255, 255, 0.95);
        }
        
        .species-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .species-header h2 {
            font-size: 2.2em;
            color: #47485f;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .research-type {
            display: inline-block;
            background: linear-gradient(135deg, #e7c64d, #f9ed65);
            color: #3e3a44;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .wisdom-insight {
            text-align: center;
            padding: 25px;
            margin: 25px 0;
            background: linear-gradient(135deg, rgba(231, 198, 77, 0.15), rgba(249, 237, 101, 0.15));
            border-radius: 15px;
            border-left: 5px solid #e7c64d;
            border: 1px solid rgba(231, 198, 77, 0.3);
        }
        
        .wisdom-insight h3 {
            color: #47485f;
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .wisdom-insight p {
            font-size: 1.1em;
            line-height: 1.7;
            color: #3e3a44;
            font-style: italic;
            font-weight: 400;
        }
        
        .intelligence-framework {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .framework-section {
            padding: 25px;
            border-radius: 15px;
            position: relative;
            border: 1px solid rgba(111, 154, 76, 0.2);
        }
        
        .perceive-section {
            background: linear-gradient(135deg, rgba(111, 154, 76, 0.1), rgba(78, 100, 64, 0.1));
            border-left: 5px solid #6f9a4c;
        }
        
        .relate-section {
            background: linear-gradient(135deg, rgba(157, 170, 236, 0.1), rgba(99, 78, 135, 0.1));
            border-left: 5px solid #9daaec;
        }
        
        .apply-section {
            background: linear-gradient(135deg, rgba(71, 72, 95, 0.1), rgba(62, 58, 68, 0.1));
            border-left: 5px solid #47485f;
        }
        
        .framework-section h3 {
            font-size: 1.4em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #47485f;
            font-weight: 600;
        }
        
        .framework-badge {
            background: linear-gradient(135deg, #6f9a4c, #4e6440);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .framework-section p {
            line-height: 1.7;
            margin-bottom: 15px;
            color: #3e3a44;
            font-weight: 400;
        }
        
        .framework-details {
            list-style: none;
            padding: 0;
        }
        
        .framework-details li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(111, 154, 76, 0.2);
            position: relative;
            padding-left: 20px;
            color: #3e3a44;
            font-weight: 400;
        }
        
        .framework-details li:before {
            content: "‚Ä¢";
            position: absolute;
            left: 0;
            color: #6f9a4c;
            font-weight: bold;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .action-btn {
            flex: 1;
            min-width: 200px;
            padding: 15px 25px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .breakdown-btn {
            background: linear-gradient(135deg, #47485f, #3e3a44);
        }
        
        .contribute-btn {
            background: linear-gradient(135deg, #e7c64d, #f9ed65);
            color: #3e3a44;
        }
        
        .research-another-btn {
            background: linear-gradient(135deg, #9daaec, #634e87);
        }
        
        .constellation-btn {
            background: linear-gradient(135deg, #6f9a4c, #4e6440);
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(71, 72, 95, 0.2);
        }
        
        .loading-enhanced {
            text-align: center;
            padding: 60px 20px;
            margin: 20px 0;
        }
        
        .research-animation {
            font-size: 64px;
            animation: research-pulse 2s infinite;
            margin-bottom: 20px;
        }
        
        @keyframes research-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .constellation-container {
            height: 500px;
            margin: 30px 0;
            background: rgba(71, 72, 95, 0.1);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(71, 72, 95, 0.2);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(71, 72, 95, 0.6);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: rgba(240, 246, 253, 0.98);
            margin: 3% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid rgba(111, 154, 76, 0.3);
            box-shadow: 0 8px 32px rgba(71, 72, 95, 0.3);
        }
        
        .form-group {
            margin: 20px 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #47485f;
            font-family: 'Poppins', sans-serif;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #9daaec;
            border-radius: 10px;
            font-size: 14px;
            background: #f0f6fd;
            font-family: 'Poppins', sans-serif;
            color: #3e3a44;
            resize: vertical;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #6f9a4c;
            background: white;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .enhanced-dimension {
            background: linear-gradient(135deg, rgba(111, 154, 76, 0.08), rgba(231, 198, 77, 0.08));
            border-left: 4px solid #6f9a4c;
            border: 1px solid rgba(111, 154, 76, 0.2);
        }
        
        .temporal-dimension {
            background: linear-gradient(135deg, rgba(231, 198, 77, 0.08), rgba(249, 237, 101, 0.08));
            border-left: 4px solid #e7c64d;
            border: 1px solid rgba(231, 198, 77, 0.2);
        }
        
        .energetic-dimension {
            background: linear-gradient(135deg, rgba(78, 100, 64, 0.08), rgba(111, 154, 76, 0.08));
            border-left: 4px solid #4e6440;
            border: 1px solid rgba(78, 100, 64, 0.2);
        }
        
        .collective-dimension {
            background: linear-gradient(135deg, rgba(157, 170, 236, 0.08), rgba(99, 78, 135, 0.08));
            border-left: 4px solid #9daaec;
            border: 1px solid rgba(157, 170, 236, 0.2);
        }
        
        .adaptive-dimension {
            background: linear-gradient(135deg, rgba(99, 78, 135, 0.08), rgba(71, 72, 95, 0.08));
            border-left: 4px solid #634e87;
            border: 1px solid rgba(99, 78, 135, 0.2);
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .search-grid {
                grid-template-columns: 1fr;
            }
            
            .intelligence-framework {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-btn {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header glass">
            <h1>Species Intelligence Research Agent</h1>
            <p>Redefining Intelligence Through the Perceive ‚Ä¢ Relate ‚Ä¢ Apply Framework</p>
        </header>
        
        <section class="search-section glass">
            <h2 style="color: #47485f; margin-bottom: 20px; font-weight: 600;">Explore Species Intelligence</h2>
            <div class="search-grid">
                <input type="text" class="species-input" id="species1" placeholder="Enter first species (e.g., dolphins)" />
                <input type="text" class="species-input" id="species2" placeholder="Enter second species (optional)" />
                <input type="text" class="species-input" id="species3" placeholder="Enter third species (optional)" />
                <input type="text" class="species-input" id="species4" placeholder="Enter fourth species (optional)" />
                <input type="text" class="species-input" id="species5" placeholder="Enter fifth species (optional)" />
            </div>
            
            <div class="options-section">
                <h3 style="color: #47485f; margin-bottom: 15px; font-weight: 600;">Enhanced Research Options</h3>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="includeIndigenous" />
                        <label for="includeIndigenous">Include Indigenous Knowledge</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="includeBiomimicry" />
                        <label for="includeBiomimicry">Include Biomimicry Applications</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="includeHuman" />
                        <label for="includeHuman">Compare with Human Intelligence</label>
                    </div>
                </div>
            </div>
            
            <button class="research-btn" onclick="conductResearch()">
                üî¨ Reveal Intelligence
            </button>
            <button class="research-btn contribute-btn" onclick="showContributionForm()" style="background: linear-gradient(135deg, #e7c64d, #f9ed65); color: #3e3a44; margin-left: 10px;">
                ü§ù Contribute Knowledge
            </button>
            <button class="research-btn" onclick="window.open('https://ai-consciousness-bridge.netlify.app/', '_blank')" style="background: linear-gradient(135deg, #634e87, #9daaec); margin-left: 10px;">
                üåâ AI Consciousness Bridge
            </button>
            
            <div style="margin-top: 20px;">
                <div id="usageDisplay" style="color: #47485f; font-size: 14px; font-weight: 500;"></div>
            </div>
        </section>
        
        <div id="constellationContainer" class="constellation-container glass" style="display: none;">
            <canvas id="constellationCanvas" width="100%" height="500"></canvas>
        </div>
        
        <div id="results"></div>
    </div>
    
    <!-- Community Contribution Modal -->
    <div id="contributionModal" class="modal">
        <div class="modal-content glass">
            <span style="position: absolute; right: 20px; top: 15px; font-size: 28px; font-weight: bold; cursor: pointer; color: #47485f;" onclick="closeContributionModal()">&times;</span>
            <h3 style="color: #47485f; font-weight: 600;">Contribute Species Intelligence Knowledge</h3>
            <p style="color: #3e3a44;">Share your research, observations, or insights about species intelligence</p>
            
            <div id="contributionForm">
                <div class="form-group">
                    <label for="contributorName">Your Name/Organization *:</label>
                    <input type="text" id="contributorName" required>
                </div>
                
                <div class="form-group">
                    <label for="contributorEmail">Email (for verification) *:</label>
                    <input type="email" id="contributorEmail" required>
                </div>
                
                <div class="form-group">
                    <label for="speciesName">Species Name *:</label>
                    <input type="text" id="speciesName" required>
                </div>
                
                <div class="form-group">
                    <label for="wisdomInsight">Key Wisdom Insight *:</label>
                    <textarea id="wisdomInsight" rows="3" required placeholder="What profound insight about this species' intelligence should people know?"></textarea>
                </div>
                
                <button onclick="submitContribution()" style="background: linear-gradient(135deg, #6f9a4c, #4e6440); color: white; border: none; padding: 15px 30px; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: 600; width: 100%; margin-top: 20px; font-family: 'Poppins', sans-serif;">Submit Contribution</button>
            </div>
        </div>
    </div>
    
    <!-- Intelligence Mapping Modal -->
    <div id="mappingModal" class="modal">
        <div class="modal-content glass" style="max-width: 900px;">
            <span style="position: absolute; right: 20px; top: 15px; font-size: 28px; font-weight: bold; cursor: pointer; color: #47485f;" onclick="closeMappingModal()">&times;</span>
            <div id="mappingContent"></div>
        </div>
    </div>

    <script>
        console.log('üöÄ Starting Species Intelligence Research Agent...');
        
        // Configuration
        const CONFIG = {
            DAILY_SEARCH_LIMIT: 6,
            MONTHLY_BUDGET: 100,
            COST_PER_SEARCH: 0.50
        };
        
        // Global state
        let currentSpeciesData = [];
        let researchHistory = JSON.parse(localStorage.getItem('researchHistory') || '[]');
        let dailyUsage = JSON.parse(localStorage.getItem('dailyUsage') || '{}');
        let monthlySpend = parseFloat(localStorage.getItem('monthlySpend') || '0');
        
        // Enhanced Intelligence Mapping State
        let intelligenceVectors = JSON.parse(localStorage.getItem('intelligenceVectors') || '{}');
        let constellationData = JSON.parse(localStorage.getItem('constellationData') || '[]');
        let mappingPatterns = JSON.parse(localStorage.getItem('mappingPatterns') || '{}');
        
        // Enhanced AI API Integration
        async function callAnthropicAPI(speciesName, options) {
            console.log('=== CALLING AI API FOR:', speciesName, '===');
            const prompt = createResearchPrompt(speciesName, options);
            
            try {
                console.log('Making request to Netlify function...');
                const response = await fetch('/.netlify/functions/research-species', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        species: speciesName,
                        prompt: prompt,
                        options: options
                    })
                });
                
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Response error:', errorText);
                    throw new Error(`API Error: ${response.status} - ${errorText}`);
                }
                
                const data = await response.json();
                console.log('Received data:', data);
                
                if (data.success && data.response) {
                    console.log('‚úÖ AI API call successful for', speciesName);
                    return parseAIResponse(data.response, speciesName);
                } else {
                    console.warn('‚ö†Ô∏è API returned data but no success flag:', data);
                    return parseAIResponse(data.response || data, speciesName);
                }
            } catch (error) {
                console.error('‚ùå AI API Error for', speciesName, ':', error);
                console.log('üîÑ Falling back to enhanced local data');
                const fallbackData = generateEnhancedFallback(speciesName, options);
                fallbackData.fallbackReason = `API Error: ${error.message}`;
                fallbackData.researchBacked = false;
                return fallbackData;
            }
        }
        
        function createResearchPrompt(speciesName, options) {
            const indigenousKnowledge = options.includeIndigenous ? `
                - Indigenous wisdom and traditional ecological knowledge from various cultures
                - Sacred relationships and ceremonial connections with this species
                - Traditional uses and spiritual significance across different indigenous traditions` : '';
            
            const biomimicryApplications = options.includeBiomimicry ? `
                - Current biomimicry applications inspired by this species
                - Potential future technological innovations based on their capabilities
                - Economic and environmental impact of species-inspired technologies` : '';
            
            return `You are a multidisciplinary species intelligence researcher specializing in consciousness studies and quantum biology. Research ${speciesName} through the revolutionary "Perceive/Relate/Apply" intelligence framework.

RESEARCH REQUIREMENTS:
1. PERCEIVE: How does ${speciesName} perceive their world?
   - Sensory capabilities and unique perceptual gifts
   - Environmental awareness and information processing
   - Quantum sensing abilities and field perception
   - Survival perception mechanisms

2. RELATE: How does ${speciesName} relate to their world?
   - Social structures and communication methods
   - Ecological relationships and symbiosis
   - Emotional and energetic connections
   - Cultural significance in human societies
   - Interspecies relationship patterns

3. APPLY: How does ${speciesName} apply their intelligence?
   - Problem-solving behaviors and adaptations
   - Tool use and environmental manipulation
   - Learning, memory, and knowledge transfer
   - Contributions to ecosystem health and balance

SOURCES TO CONSULT:
- Peer-reviewed biology, ecology, ethology, and neuroscience research
- Consciousness and quantum biology studies${indigenousKnowledge}${biomimicryApplications}
- Behavioral studies and cognitive research
- Conservation and environmental research

RESPONSE FORMAT:
Provide a JSON response with this exact structure:
{
    "species": "${speciesName}",
    "wisdomInsight": "One profound insight about this species' intelligence that could expand human consciousness (2-3 sentences)",
    "perceive": {
        "summary": "How they perceive their world (2-3 sentences)",
        "details": ["specific perceptual capability 1", "specific perceptual capability 2", "specific perceptual capability 3", "quantum/field perception aspect"]
    },
    "relate": {
        "summary": "How they relate to their world (2-3 sentences)",
        "details": ["relationship aspect 1", "relationship aspect 2", "relationship aspect 3", "consciousness connection aspect"]
    },
    "apply": {
        "summary": "How they apply intelligence (2-3 sentences)",
        "details": ["application example 1", "application example 2", "application example 3", "ecosystem contribution"]
    },
    "humanLearnings": "What humans can learn from ${speciesName}'s intelligence for consciousness evolution",
    "conservationWisdom": "How their intelligence relates to conservation needs and ecosystem health",
    "quantumAspects": "Quantum biology and consciousness connections documented in research",
    "temporalIntelligence": "How this species perceives and works with time, seasonal cycles, and long-term patterns (4-5 sentences)",
    "energeticIntelligence": "Biofield interactions, electromagnetic sensitivity, energy optimization with documented cases (4-5 sentences)",
    "collectiveWisdom": "Group consciousness, collective decision-making, and distributed intelligence with specific behaviors (4-5 sentences)",
    "adaptiveStrategies": "Real-time adaptation mechanisms, crisis responses, and resilience with documented examples (4-5 sentences)",
    "sources": ["key research source 1", "key research source 2", "key research source 3", "consciousness/quantum research source"]
}

Focus on consciousness-expanding insights that bridge science and wisdom. Respond ONLY with valid JSON.`;
        }
        
        function parseAIResponse(responseText, speciesName) {
            try {
                console.log('Parsing AI response for:', speciesName);
                const cleanedResponse = responseText
                    .replace(/```json\n?/g, "")
                    .replace(/```\n?/g, "")
                    .trim();
                
                const data = JSON.parse(cleanedResponse);
                
                return {
                    species: data.species || speciesName,
                    wisdomInsight: data.wisdomInsight || "This species demonstrates unique intelligence worthy of deeper study.",
                    perceive: data.perceive || { summary: "Advanced perceptual capabilities", details: [] },
                    relate: data.relate || { summary: "Complex relational intelligence", details: [] },
                    apply: data.apply || { summary: "Sophisticated problem-solving abilities", details: [] },
                    humanLearnings: data.humanLearnings || "Valuable lessons for human consciousness evolution",
                    conservationWisdom: data.conservationWisdom || "Important for ecosystem balance and health",
                    quantumAspects: data.quantumAspects || "Consciousness connections being explored by researchers",
                    temporalIntelligence: data.temporalIntelligence || "Sophisticated time perception and seasonal awareness",
                    energeticIntelligence: data.energeticIntelligence || "Biofield sensitivity and energy optimization",
                    collectiveWisdom: data.collectiveWisdom || "Group consciousness and collective decision-making abilities",
                    adaptiveStrategies: data.adaptiveStrategies || "Remarkable adaptation mechanisms and resilience",
                    sources: data.sources || ["Research compilation"],
                    researchBacked: true,
                    timestamp: new Date().toISOString()
                };
            } catch (parseError) {
                console.warn("Failed to parse AI response:", parseError);
                return generateEnhancedFallback(speciesName, {});
            }
        }
        
        // Main research function - AI-POWERED VERSION
        async function conductResearch() {
            console.log('üî¨ Starting AI-powered research...'); // This should appear in console
            
            const speciesInputs = [
                document.getElementById('species1').value.trim(),
                document.getElementById('species2').value.trim(),
                document.getElementById('species3').value.trim(),
                document.getElementById('species4').value.trim(),
                document.getElementById('species5').value.trim()
            ].filter(species => species.length > 0);
            
            if (speciesInputs.length === 0) {
                alert('Please enter at least one species name');
                return;
            }
            
            const today = new Date().toDateString();
            if (!dailyUsage[today]) dailyUsage[today] = 0;
            
            // Cost limiting enforcement
            if (dailyUsage[today] >= CONFIG.DAILY_SEARCH_LIMIT) {
                alert(`Daily search limit reached (${CONFIG.DAILY_SEARCH_LIMIT} searches). Please try again tomorrow to stay within budget limits.`);
                return;
            }
            
            const projectedCost = monthlySpend + (CONFIG.COST_PER_SEARCH * speciesInputs.length);
            if (projectedCost > CONFIG.MONTHLY_BUDGET) {
                alert(`Monthly budget limit would be exceeded (${projectedCost.toFixed(2)} > ${CONFIG.MONTHLY_BUDGET}). Please wait until next month or reduce the number of species.`);
                return;
            }
            
            if (projectedCost > (CONFIG.MONTHLY_BUDGET * 0.8) && monthlySpend <= (CONFIG.MONTHLY_BUDGET * 0.8)) {
                if (!confirm(`Warning: This search will use ${((projectedCost/CONFIG.MONTHLY_BUDGET)*100).toFixed(1)}% of your monthly budget. Continue?`)) {
                    return;
                }
            }
            
            console.log('‚úÖ Budget checks passed, researching species:', speciesInputs);
            
            // Get options
            const options = {
                includeIndigenous: document.getElementById('includeIndigenous').checked,
                includeBiomimicry: document.getElementById('includeBiomimicry').checked,
                includeHuman: document.getElementById('includeHuman').checked
            };
            
            if (options.includeHuman) {
                speciesInputs.push('Human');
            }
            
            const resultsDiv = document.getElementById('results');
            
            try {
                console.log('üî¨ Starting AI research for:', speciesInputs);
                
                // Show loading
                resultsDiv.innerHTML = `
                    <div class="results-container glass fade-in">
                        <div class="loading-enhanced">
                            <div class="research-animation">üß¨</div>
                            <h3 style="color: #47485f;">Conducting Deep Species Intelligence Research</h3>
                            <p style="color: #3e3a44;">Enhanced Claude AI analysis with temporal, energetic, collective, and adaptive intelligence dimensions</p>
                            <p style="color: #6f9a4c; font-size: 14px; margin-top: 10px;">This comprehensive research may take 15-20 seconds per species...</p>
                        </div>
                    </div>
                `;
                
                // Call AI API for each species
                const researchResults = [];
                for (let i = 0; i < speciesInputs.length; i++) {
                    const species = speciesInputs[i];
                    console.log(`üîç AI Research ${i + 1}/${speciesInputs.length}: ${species}`);
                    
                    // Update loading message
                    resultsDiv.innerHTML = `
                        <div class="results-container glass fade-in">
                            <div class="loading-enhanced">
                                <div class="research-animation">üß¨</div>
                                <h3 style="color: #47485f;">Researching ${species}...</h3>
                                <p style="color: #3e3a44;">Species ${i + 1} of ${speciesInputs.length} ‚Ä¢ Enhanced Claude AI</p>
                                <div style="background: rgba(111, 154, 76, 0.2); padding: 10px; border-radius: 10px; margin: 10px 0;">
                                    <div style="width: ${(i/speciesInputs.length)*100}%; height: 4px; background: #6f9a4c; border-radius: 2px;"></div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // THIS IS THE KEY: Actually call the AI API
                    const result = await callAnthropicAPI(species, options);
                    researchResults.push(result);
                    console.log(`‚úÖ AI Research completed for ${species}`);
                }
                
                console.log('üéâ All AI research completed!');
                
                // Update usage tracking
                dailyUsage[today]++;
                monthlySpend += CONFIG.COST_PER_SEARCH * speciesInputs.length;
                localStorage.setItem('dailyUsage', JSON.stringify(dailyUsage));
                localStorage.setItem('monthlySpend', monthlySpend.toString());
                
                // Store in research history
                const searchRecord = {
                    species: speciesInputs,
                    timestamp: new Date().toISOString(),
                    options: options,
                    results: researchResults
                };
                researchHistory.push(searchRecord);
                localStorage.setItem('researchHistory', JSON.stringify(researchHistory));
                
                // Update intelligence mapping
                updateIntelligenceMapping(researchResults);
                
                // Display results
                displayEnhancedResults(researchResults);
                
                // Update usage
                updateUsageDisplay();
                
                console.log('‚úÖ AI-powered research completed successfully');
                
            } catch (error) {
                console.error('‚ùå AI Research failed:', error);
                resultsDiv.innerHTML = `
                    <div class="results-container glass fade-in">
                        <div style="text-align: center; padding: 40px;">
                            <h3 style="color: #47485f;">Research Temporarily Unavailable</h3>
                            <p style="color: #3e3a44;">Error: ${error.message}</p>
                            <button onclick="conductResearch()" style="background: linear-gradient(135deg, #6f9a4c, #4e6440); color: white; border: none; padding: 12px 25px; border-radius: 20px; cursor: pointer; margin-top: 15px; font-family: 'Poppins', sans-serif;">Try Again</button>
                        </div>
                    </div>
                `;
            }
        }
        
        // Generate enhanced fallback data
        function generateEnhancedFallback(speciesName, options) {
            return {
                species: speciesName,
                wisdomInsight: `${speciesName} represents a remarkable form of consciousness that has evolved unique ways of perceiving, relating to, and applying intelligence within their environment. Their cognitive abilities demonstrate that intelligence manifests in diverse forms across the natural world, each adapted to specific ecological niches. Understanding their intelligence offers profound insights into alternative ways of being conscious and aware.`,
                perceive: {
                    summary: `${speciesName} perceives their world through sophisticated sensory systems adapted to their environmental niche. Their perceptual capabilities enable complex information gathering about surroundings and social dynamics. These adaptations support survival and environmental interaction.`,
                    details: ["Specialized sensory capabilities", "Environmental awareness systems", "Social perception abilities", "Quantum field sensitivity"]
                },
                relate: {
                    summary: `${speciesName} maintains relationships through communication and social structures. Their intelligence encompasses species connections and ecosystem relationships. These interactions support survival and ecosystem balance.`,
                    details: ["Social communication systems", "Ecological partnerships", "Community cooperation", "Consciousness connections"]
                },
                apply: {
                    summary: `${speciesName} applies intelligence through problem-solving and adaptive strategies. Their abilities enable environmental manipulation and learning from experience. These applications contribute to survival and ecosystem health.`,
                    details: ["Problem-solving behaviors", "Environmental adaptation", "Learning systems", "Ecosystem contributions"]
                },
                temporalIntelligence: `${speciesName} demonstrates sophisticated temporal intelligence through synchronization with natural cycles and environmental rhythms. They possess internal biological clocks that coordinate with seasonal changes and daily patterns. Their temporal awareness enables precise timing for critical activities and long-term environmental adaptation. This time perception supports migration, reproduction, and resource management across multiple temporal scales.`,
                energeticIntelligence: `${speciesName} exhibits remarkable energetic intelligence through sensitivity to electromagnetic fields and biofield interactions. They have evolved mechanisms for energy conservation and optimization in their daily activities. Their systems detect subtle energy fluctuations that guide navigation and social interactions. This energetic awareness contributes to health maintenance and ecosystem coordination.`,
                collectiveWisdom: `${speciesName} displays sophisticated collective wisdom through group decision-making and information sharing capabilities. Their social structures enable distributed intelligence where individual knowledge contributes to collective problem-solving. They demonstrate emergent behaviors where group intelligence exceeds individual capabilities. This collective consciousness enables survival through cooperation and coordinated responses.`,
                adaptiveStrategies: `${speciesName} exhibits extraordinary adaptive strategies enabling survival across changing environmental conditions. They possess rapid response mechanisms for environmental threats and resource fluctuations. Their behavioral flexibility allows strategy modification based on experience and circumstances. These adaptive mechanisms enable continuous environmental adaptation while maintaining species integrity.`,
                humanLearnings: `Humans can learn valuable lessons from ${speciesName} about intelligence and environmental adaptation. Their strategies offer insights into sustainable living and community cooperation. Their approaches may inspire technological and social innovations. Understanding expands concepts of consciousness across species.`,
                conservationWisdom: `${speciesName} plays crucial ecosystem roles requiring conservation for environmental stability. Their intelligence supports biodiversity and habitat integrity. Threats include habitat loss and human disruption of natural behaviors. Conservation must consider their intelligence and social requirements.`,
                quantumAspects: `${speciesName} may utilize quantum processes in sensory systems and cognitive processing. Research suggests quantum effects in navigation and environmental sensitivity. Understanding reveals insights into consciousness across species.`,
                sources: ["Species intelligence research", "Consciousness studies", "Ecological research"],
                researchBacked: false,
                timestamp: new Date().toISOString()
            };
        }
        
        // Display enhanced results
        function displayEnhancedResults(dataArray) {
            const resultsDiv = document.getElementById('results');
            
            let html = '<div class="fade-in">';
            
            // Individual species results
            dataArray.forEach((data, index) => {
                html += `
                    <div class="results-container glass">
                        <div class="species-header">
                            <h2>${data.species}</h2>
                            <div class="research-type">
                                ${data.researchBacked ? 'üî¨ AI-Enhanced Research' : 'üìã Enhanced Framework Analysis'}
                            </div>
                        </div>
                        
                        <div class="wisdom-insight">
                            <h3>üí° Key Wisdom</h3>
                            <p>${data.wisdomInsight}</p>
                        </div>
                        
                        <div class="intelligence-framework">
                            <div class="framework-section perceive-section">
                                <h3><span class="framework-badge">PERCEIVE</span> How They Perceive</h3>
                                <p>${data.perceive.summary}</p>
                                <ul class="framework-details">
                                    ${data.perceive.details.map(detail => `<li>${detail}</li>`).join('')}
                                </ul>
                            </div>
                            
                            <div class="framework-section relate-section">
                                <h3><span class="framework-badge">RELATE</span> How They Relate</h3>
                                <p>${data.relate.summary}</p>
                                <ul class="framework-details">
                                    ${data.relate.details.map(detail => `<li>${detail}</li>`).join('')}
                                </ul>
                            </div>
                            
                            <div class="framework-section apply-section">
                                <h3><span class="framework-badge">APPLY</span> How They Apply Intelligence</h3>
                                <p>${data.apply.summary}</p>
                                <ul class="framework-details">
                                    ${data.apply.details.map(detail => `<li>${detail}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                        
                        <div class="wisdom-insight enhanced-dimension">
                            <h3>üåå Quantum Biology & Consciousness</h3>
                            <p>${data.quantumAspects}</p>
                        </div>
                        
                        <div class="wisdom-insight temporal-dimension">
                            <h3>‚è∞ Temporal Intelligence</h3>
                            <p>${data.temporalIntelligence}</p>
                        </div>
                        
                        <div class="wisdom-insight energetic-dimension">
                            <h3>‚ö° Energetic Intelligence</h3>
                            <p>${data.energeticIntelligence}</p>
                        </div>
                        
                        <div class="wisdom-insight collective-dimension">
                            <h3>ü§ù Collective Wisdom</h3>
                            <p>${data.collectiveWisdom}</p>
                        </div>
                        
                        <div class="wisdom-insight adaptive-dimension">
                            <h3>üîÑ Adaptive Strategies</h3>
                            <p>${data.adaptiveStrategies}</p>
                        </div>
                        
                        <div class="wisdom-insight enhanced-dimension">
                            <h3>üå± Human Learning Opportunities</h3>
                            <p>${data.humanLearnings}</p>
                        </div>
                        
                        <div class="wisdom-insight enhanced-dimension">
                            <h3>üåç Conservation Intelligence</h3>
                            <p>${data.conservationWisdom}</p>
                        </div>
                    </div>
                `;
            });
            
            // Action buttons
            html += `
                <div class="results-container glass">
                    <div class="action-buttons">
                        <button class="action-btn constellation-btn" onclick="showIntelligenceMapping()">
                            üåå View Intelligence Constellation
                        </button>
                        <button class="action-btn breakdown-btn" onclick="generateEnhancedPDFReport()">
                            üìÑ Download Report
                        </button>
                        <button class="action-btn contribute-btn" onclick="showContributionForm()">
                            ü§ù Contribute Knowledge
                        </button>
                        <button class="action-btn research-another-btn" onclick="resetSearch()">
                            üîç Research More Species
                        </button>
                    </div>
                    <div style="text-align: center; margin-top: 30px; padding: 15px; background: rgba(111, 154, 76, 0.1); border-radius: 10px; border: 1px solid rgba(111, 154, 76, 0.2);">
                        <small style="color: #47485f; font-size: 12px;">Enhanced research with 7 intelligence dimensions ‚Ä¢ ${dataArray.reduce((sum, d) => sum + (d.sources?.length || 0), 0)} sources consulted ‚Ä¢ ${Object.keys(intelligenceVectors).length} species in database</small>
                    </div>
                </div>
            `;
            
            html += '</div>';
            resultsDiv.innerHTML = html;
            
            // Show constellation
            updateAdvancedConstellation(dataArray);
        }
        
        // Intelligence Mapping System
        function updateIntelligenceMapping(researchResults) {
            console.log('üß† Updating intelligence mapping...');
            
            researchResults.forEach(data => {
                const vector = generateIntelligenceVector(data);
                intelligenceVectors[data.species] = vector;
                
                // Update constellation data
                const position = generateConstellationPosition(vector);
                const existingIndex = constellationData.findIndex(item => item.species === data.species);
                
                if (existingIndex >= 0) {
                    constellationData[existingIndex] = {
                        species: data.species,
                        vector: vector,
                        position: position,
                        researchBacked: data.researchBacked,
                        timestamp: data.timestamp
                    };
                } else {
                    constellationData.push({
                        species: data.species,
                        vector: vector,
                        position: position,
                        researchBacked: data.researchBacked,
                        timestamp: data.timestamp
                    });
                }
            });
            
            // Analyze patterns
            analyzeIntelligencePatterns();
            
            // Save to localStorage
            localStorage.setItem('intelligenceVectors', JSON.stringify(intelligenceVectors));
            localStorage.setItem('constellationData', JSON.stringify(constellationData));
            localStorage.setItem('mappingPatterns', JSON.stringify(mappingPatterns));
            
            console.log('‚úÖ Intelligence mapping updated!');
        }
        
        function generateIntelligenceVector(data) {
            // Calculate scores for each dimension (0-100)
            const perceiveScore = calculateDimensionScore(data.perceive);
            const relateScore = calculateDimensionScore(data.relate);
            const applyScore = calculateDimensionScore(data.apply);
            const temporalScore = calculateTextComplexity(data.temporalIntelligence || '');
            const energeticScore = calculateTextComplexity(data.energeticIntelligence || '');
            const collectiveScore = calculateTextComplexity(data.collectiveWisdom || '');
            const adaptiveScore = calculateTextComplexity(data.adaptiveStrategies || '');
            
            // Calculate overall complexity
            const complexity = (perceiveScore + relateScore + applyScore + temporalScore + 
                               energeticScore + collectiveScore + adaptiveScore) / 7;
            
            return {
                perceive: perceiveScore,
                relate: relateScore,
                apply: applyScore,
                temporal: temporalScore,
                energetic: energeticScore,
                collective: collectiveScore,
                adaptive: adaptiveScore,
                complexity: complexity,
                uniqueness: Math.random() * 100 // Simplified for now
            };
        }
        
        function calculateDimensionScore(dimension) {
            if (!dimension) return 50;
            
            let score = 50;
            
            if (dimension.summary) {
                score += Math.min(dimension.summary.length / 10, 20);
            }
            
            if (dimension.details && Array.isArray(dimension.details)) {
                score += dimension.details.length * 5;
                dimension.details.forEach(detail => {
                    if (detail && detail.length > 20) {
                        score += 2;
                    }
                });
            }
            
            return Math.min(score, 100);
        }
        
        function calculateTextComplexity(text) {
            if (!text) return 50;
            
            let score = 50;
            const wordCount = text.split(/\s+/).length;
            score += Math.min(wordCount / 5, 20);
            
            const technicalTerms = text.match(/\b(quantum|electromagnetic|consciousness|neural|cognitive|biofield|morphic|resonance|collective|adaptive)\b/gi);
            if (technicalTerms) {
                score += Math.min(technicalTerms.length * 2, 15);
            }
            
            return Math.min(score, 100);
        }
        
        function generateConstellationPosition(vector) {
            const x = (vector.perceive - 50) * 3;
            const y = (vector.relate - 50) * 3;
            const z = (vector.apply - 50) * 3;
            
            return { x, y, z };
        }
        
        function analyzeIntelligencePatterns() {
            const vectors = Object.values(intelligenceVectors);
            if (vectors.length < 2) return;
            
            const clusters = {
                highCollective: [],
                highTemporal: [],
                highEnergetic: [],
                highAdaptive: [],
                balanced: []
            };
            
            Object.entries(intelligenceVectors).forEach(([species, vector]) => {
                if (vector.collective > 80) clusters.highCollective.push(species);
                if (vector.temporal > 80) clusters.highTemporal.push(species);
                if (vector.energetic > 80) clusters.highEnergetic.push(species);
                if (vector.adaptive > 80) clusters.highAdaptive.push(species);
            });
            
            mappingPatterns = {
                clusters,
                totalMapped: vectors.length,
                lastUpdated: new Date().toISOString()
            };
        }
        
        function updateAdvancedConstellation(speciesData) {
            const container = document.getElementById('constellationContainer');
            const canvas = document.getElementById('constellationCanvas');
            const ctx = canvas.getContext('2d');
            
            container.style.display = 'block';
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            canvas.width = container.offsetWidth;
            canvas.height = 500;
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // Background gradient
            const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, Math.max(canvas.width, canvas.height) / 2);
            gradient.addColorStop(0, 'rgba(231, 198, 77, 0.05)');
            gradient.addColorStop(0.5, 'rgba(111, 154, 76, 0.05)');
            gradient.addColorStop(1, 'rgba(71, 72, 95, 0.1)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw species nodes
            constellationData.forEach((item, index) => {
                const angle = (index / constellationData.length) * 2 * Math.PI;
                const radius = 150 + (item.vector.complexity * 2);
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;
                const size = 8 + (item.vector.complexity / 20);
                
                // Node
                ctx.beginPath();
                ctx.arc(x, y, size, 0, 2 * Math.PI);
                ctx.fillStyle = item.researchBacked ? '#6f9a4c' : '#9daaec';
                ctx.fill();
                ctx.strokeStyle = '#47485f';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Species label
                ctx.fillStyle = '#47485f';
                ctx.font = '12px Poppins';
                ctx.textAlign = 'center';
                ctx.fillText(item.species, x, y + size + 20);
            });
            
            // Title
            ctx.font = '18px Poppins';
            ctx.fillStyle = '#47485f';
            ctx.textAlign = 'center';
            ctx.fillText('Species Intelligence Constellation', centerX, 30);
            
            ctx.font = '12px Poppins';
            ctx.fillStyle = '#6f9a4c';
            ctx.fillText(`${constellationData.length} species mapped`, centerX, 48);
        }
        
        // Modal functions
        function showContributionForm() {
            console.log('ü§ù Opening contribution form');
            document.getElementById('contributionModal').style.display = 'block';
        }
        
        function closeContributionModal() {
            console.log('‚ùå Closing contribution modal');
            document.getElementById('contributionModal').style.display = 'none';
        }
        
        function submitContribution() {
            alert('Thank you! Your contribution has been submitted for review. (Demo mode)');
            closeContributionModal();
        }
        
        function showIntelligenceMapping() {
            const modal = document.getElementById('mappingModal');
            const content = document.getElementById('mappingContent');
            
            content.innerHTML = `
                <div style="text-align: center; padding: 30px;">
                    <h2 style="color: #47485f; margin-bottom: 20px;">üåå Intelligence Constellation Analysis</h2>
                    <p style="color: #6f9a4c; margin-bottom: 30px;">Advanced pattern recognition across ${Object.keys(intelligenceVectors).length} mapped species</p>
                    
                    <div style="background: rgba(111, 154, 76, 0.1); padding: 20px; border-radius: 15px; margin: 20px 0;">
                        <h3 style="color: #47485f; margin-bottom: 15px;">üìä Intelligence Metrics</h3>
                        <p>Species Mapped: ${Object.keys(intelligenceVectors).length}</p>
                        <p>Total Research Sessions: ${researchHistory.length}</p>
                        <p>Constellation Patterns: Advanced mapping active</p>
                    </div>
                    
                    <button onclick="closeMappingModal()" style="background: linear-gradient(135deg, #9daaec, #634e87); color: white; border: none; padding: 12px 25px; border-radius: 20px; cursor: pointer; font-family: 'Poppins', sans-serif;">
                        Close
                    </button>
                </div>
            `;
            
            modal.style.display = 'block';
        }
        
        function closeMappingModal() {
            document.getElementById('mappingModal').style.display = 'none';
        }
        
        function generateEnhancedPDFReport() {
            if (!currentSpeciesData || currentSpeciesData.length === 0) {
                alert('No species data available for PDF generation. Please conduct research first.');
                return;
            }
            
            try {
                if (typeof window.jspdf === 'undefined' || !window.jspdf.jsPDF) {
                    alert('PDF library is loading. Please wait a moment and try again.');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Simple PDF generation
                doc.setFontSize(20);
                doc.text('Species Intelligence Research Report', 20, 30);
                
                doc.setFontSize(14);
                doc.text('Generated by Species Intelligence Research Agent', 20, 50);
                doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, 65);
                
                let yPos = 90;
                currentSpeciesData.forEach((species, index) => {
                    if (yPos > 250) {
                        doc.addPage();
                        yPos = 30;
                    }
                    
                    doc.setFontSize(16);
                    doc.text(`${index + 1}. ${species.species}`, 20, yPos);
                    yPos += 15;
                    
                    doc.setFontSize(12);
                    const wisdom = doc.splitTextToSize(species.wisdomInsight, 170);
                    doc.text(wisdom, 20, yPos);
                    yPos += wisdom.length * 6 + 10;
                });
                
                const filename = `Species-Intelligence-Report-${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(filename);
                
                alert(`‚úÖ PDF Report Generated: ${filename}`);
                
            } catch (error) {
                console.error('PDF Generation Error:', error);
                alert('Error generating PDF. Please try again.');
            }
        }
        
        function resetSearch() {
            console.log('üîÑ Resetting search');
            document.getElementById('species1').value = '';
            document.getElementById('species2').value = '';
            document.getElementById('species3').value = '';
            document.getElementById('species4').value = '';
            document.getElementById('species5').value = '';
            document.getElementById('includeIndigenous').checked = false;
            document.getElementById('includeBiomimicry').checked = false;
            document.getElementById('includeHuman').checked = false;
            document.getElementById('results').innerHTML = '';
            document.getElementById('constellationContainer').style.display = 'none';
            document.getElementById('species1').focus();
        }
        
        function updateUsageDisplay() {
            const today = new Date().toDateString();
            const todayUsage = dailyUsage[today] || 0;
            const budgetPercent = (monthlySpend / CONFIG.MONTHLY_BUDGET * 100).toFixed(1);
            
            document.getElementById('usageDisplay').innerHTML = `
                Enhanced searches today: ${todayUsage}/${CONFIG.DAILY_SEARCH_LIMIT} | 
                Monthly budget: ${budgetPercent}% of ${CONFIG.MONTHLY_BUDGET} | 
                Species mapped: ${Object.keys(intelligenceVectors).length}
            `;
        }
        
        // Make all functions globally accessible - CRITICAL FIX
        window.conductResearch = conductResearch;
        window.showContributionForm = showContributionForm;
        window.closeContributionModal = closeContributionModal;
        window.submitContribution = submitContribution;
        window.showIntelligenceMapping = showIntelligenceMapping;
        window.closeMappingModal = closeMappingModal;
        window.generateEnhancedPDFReport = generateEnhancedPDFReport;
        window.resetSearch = resetSearch;
        
        console.log('‚úÖ All functions made globally accessible');
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM loaded, initializing app...');
            
            // Add enter key support
            const inputs = document.querySelectorAll('.species-input');
            inputs.forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        conductResearch();
                    }
                });
            });
            
            // Modal event listeners
            window.addEventListener('click', function(event) {
                const contributionModal = document.getElementById('contributionModal');
                const mappingModal = document.getElementById('mappingModal');
                
                if (event.target === contributionModal) {
                    closeContributionModal();
                }
                if (event.target === mappingModal) {
                    closeMappingModal();
                }
            });
            
            // Update usage display
            updateUsageDisplay();
            
            console.log('‚úÖ App initialized successfully!');
        });
        
        console.log('üéâ Species Intelligence Research Agent loaded successfully!');
        console.log('Functions available:', {
            conductResearch: typeof window.conductResearch,
            showContributionForm: typeof window.showContributionForm,
            showIntelligenceMapping: typeof window.showIntelligenceMapping
        });
    </script>
</body>
</html>
