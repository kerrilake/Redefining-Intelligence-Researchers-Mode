<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Species Intelligence Research Agent - Redefining Intelligence</title>
    <!-- PDF Generation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Poppins Font Integration -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f0f6fd 0%, #9daaec 100%);
            min-height: 100vh;
            color: #3e3a44;
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }
        
        .glass {
            background: rgba(240, 246, 253, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(111, 154, 76, 0.2);
            box-shadow: 0 8px 32px rgba(71, 72, 95, 0.15);
        }
        
        .header {
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .header h1 {
            font-size: 2.5em;
            color: #47485f;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            color: #6f9a4c;
            font-size: 1.1em;
            font-style: italic;
            font-weight: 400;
        }
        
        .search-section {
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .species-input {
            padding: 15px;
            font-size: 16px;
            border: 2px solid #9daaec;
            border-radius: 12px;
            background: #f0f6fd;
            color: #3e3a44;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
        }
        
        .species-input:focus {
            outline: none;
            border-color: #6f9a4c;
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(111, 154, 76, 0.2);
        }
        
        .options-section {
            margin: 20px 0;
            text-align: left;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 15px 0;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #47485f;
            font-weight: 500;
        }
        
        .checkbox-item input[type="checkbox"] {
            transform: scale(1.2);
            accent-color: #6f9a4c;
        }
        
        /* Button Layout - 2x2 Grid */
        .button-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px auto;
            max-width: 800px;
        }
        
        .action-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .research-btn {
            background: linear-gradient(135deg, #6f9a4c, #4e6440);
            color: white;
        }
        
        .contribute-btn {
            background: linear-gradient(135deg, #e7c64d, #f9ed65);
            color: #3e3a44;
        }
        
        .ai-bridge-btn {
            background: linear-gradient(135deg, #9daaec, #634e87);
            color: white;
        }
        
        .map-btn {
            background: linear-gradient(135deg, #47485f, #3e3a44);
            color: white;
        }
        
        .results-container {
            padding: 30px;
            margin: 20px 0;
            position: relative;
            background: rgba(255, 255, 255, 0.95);
        }
        
        .species-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .species-header h2 {
            font-size: 2.2em;
            color: #47485f;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .research-type {
            display: inline-block;
            background: linear-gradient(135deg, #e7c64d, #f9ed65);
            color: #3e3a44;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .wisdom-insight {
            text-align: center;
            padding: 25px;
            margin: 25px 0;
            background: linear-gradient(135deg, rgba(231, 198, 77, 0.15), rgba(249, 237, 101, 0.15));
            border-radius: 15px;
            border-left: 5px solid #e7c64d;
            border: 1px solid rgba(231, 198, 77, 0.3);
        }
        
        .wisdom-insight h3 {
            color: #47485f;
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .wisdom-insight p {
            font-size: 1.1em;
            line-height: 1.7;
            color: #3e3a44;
            font-style: italic;
            font-weight: 400;
        }
        
        .intelligence-framework {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .framework-section {
            padding: 25px;
            border-radius: 15px;
            position: relative;
            border: 1px solid rgba(111, 154, 76, 0.2);
        }
        
        .perceive-section {
            background: linear-gradient(135deg, rgba(111, 154, 76, 0.1), rgba(78, 100, 64, 0.1));
            border-left: 5px solid #6f9a4c;
        }
        
        .relate-section {
            background: linear-gradient(135deg, rgba(157, 170, 236, 0.1), rgba(99, 78, 135, 0.1));
            border-left: 5px solid #9daaec;
        }
        
        .apply-section {
            background: linear-gradient(135deg, rgba(71, 72, 95, 0.1), rgba(62, 58, 68, 0.1));
            border-left: 5px solid #47485f;
        }
        
        .framework-section h3 {
            font-size: 1.4em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #47485f;
            font-weight: 600;
        }
        
        .framework-badge {
            background: linear-gradient(135deg, #6f9a4c, #4e6440);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .framework-section p {
            line-height: 1.7;
            margin-bottom: 15px;
            color: #3e3a44;
            font-weight: 400;
        }
        
        .framework-details {
            list-style: none;
            padding: 0;
        }
        
        .framework-details li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(111, 154, 76, 0.2);
            position: relative;
            padding-left: 20px;
            color: #3e3a44;
            font-weight: 400;
        }
        
        .framework-details li:before {
            content: "•";
            position: absolute;
            left: 0;
            color: #6f9a4c;
            font-weight: bold;
        }
        
        .loading-enhanced {
            text-align: center;
            padding: 60px 20px;
            margin: 20px 0;
        }
        
        .research-animation {
            font-size: 64px;
            animation: research-pulse 2s infinite;
            margin-bottom: 20px;
        }
        
        @keyframes research-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .constellation-container {
            height: 500px;
            margin: 30px 0;
            background: rgba(71, 72, 95, 0.1);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(71, 72, 95, 0.2);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(71, 72, 95, 0.6);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: rgba(240, 246, 253, 0.98);
            margin: 3% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid rgba(111, 154, 76, 0.3);
            box-shadow: 0 8px 32px rgba(71, 72, 95, 0.3);
        }
        
        .form-group {
            margin: 20px 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #47485f;
            font-family: 'Poppins', sans-serif;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #9daaec;
            border-radius: 10px;
            font-size: 14px;
            background: #f0f6fd;
            font-family: 'Poppins', sans-serif;
            color: #3e3a44;
            resize: vertical;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #6f9a4c;
            background: white;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .enhanced-dimension {
            background: linear-gradient(135deg, rgba(111, 154, 76, 0.08), rgba(231, 198, 77, 0.08));
            border-left: 4px solid #6f9a4c;
            border: 1px solid rgba(111, 154, 76, 0.2);
        }
        
        .temporal-dimension {
            background: linear-gradient(135deg, rgba(231, 198, 77, 0.08), rgba(249, 237, 101, 0.08));
            border-left: 4px solid #e7c64d;
            border: 1px solid rgba(231, 198, 77, 0.2);
        }
        
        .energetic-dimension {
            background: linear-gradient(135deg, rgba(78, 100, 64, 0.08), rgba(111, 154, 76, 0.08));
            border-left: 4px solid #4e6440;
            border: 1px solid rgba(78, 100, 64, 0.2);
        }
        
        .collective-dimension {
            background: linear-gradient(135deg, rgba(157, 170, 236, 0.08), rgba(99, 78, 135, 0.08));
            border-left: 4px solid #9daaec;
            border: 1px solid rgba(157, 170, 236, 0.2);
        }
        
        .adaptive-dimension {
            background: linear-gradient(135deg, rgba(99, 78, 135, 0.08), rgba(71, 72, 95, 0.08));
            border-left: 4px solid #634e87;
            border: 1px solid rgba(99, 78, 135, 0.2);
        }
        
        /* Simplified Footer */
        .footer {
            margin-top: 60px;
            padding: 30px 20px;
            text-align: center;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(111, 154, 76, 0.2);
            box-shadow: 0 8px 32px rgba(71, 72, 95, 0.15);
        }
        
        .footer h3 {
            color: #47485f;
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .footer p {
            color: #6f9a4c;
            font-size: 0.95em;
            margin-bottom: 20px;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .footer-links a {
            color: #6f9a4c;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        
        .footer-links a:hover {
            color: #4e6440;
        }
        
        .footer-links span {
            color: #9daaec;
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .search-grid {
                grid-template-columns: 1fr;
            }
            
            .button-grid {
                grid-template-columns: 1fr;
            }
            
            .intelligence-framework {
                grid-template-columns: 1fr;
            }
            
            .footer-links {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header glass">
            <h1>Species Intelligence Research Agent</h1>
            <p>Redefining Intelligence Through the Perceive • Relate • Apply Framework</p>
        </header>
        
        <section class="search-section glass">
            <h2 style="color: #47485f; margin-bottom: 20px; font-weight: 600;">Explore Species Intelligence</h2>
            <div class="search-grid">
                <input type="text" class="species-input" id="species1" placeholder="Enter first species (e.g., dolphins)" />
                <input type="text" class="species-input" id="species2" placeholder="Enter second species (optional)" />
                <input type="text" class="species-input" id="species3" placeholder="Enter third species (optional)" />
                <input type="text" class="species-input" id="species4" placeholder="Enter fourth species (optional)" />
                <input type="text" class="species-input" id="species5" placeholder="Enter fifth species (optional)" />
            </div>
            
            <div class="options-section">
                <h3 style="color: #47485f; margin-bottom: 15px; font-weight: 600;">Enhanced Research Options</h3>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="includeIndigenous" />
                        <label for="includeIndigenous">Include Indigenous Knowledge</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="includeBiomimicry" />
                        <label for="includeBiomimicry">Include Biomimicry Applications</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="includeHuman" />
                        <label for="includeHuman">Include Human Intelligence</label>
                    </div>
                </div>
            </div>
            
            <div class="button-grid">
                <button class="action-btn research-btn" onclick="conductResearch()">
                    🔬 Reveal Intelligence
                </button>
                <button class="action-btn contribute-btn" onclick="showContributionForm()">
                    🤝 Contribute Knowledge
                </button>
                <button class="action-btn ai-bridge-btn" onclick="window.open('https://ai-consciousness-bridge.netlify.app/', '_blank')">
                    🌉 Explore AI Consciousness Bridge
                </button>
                <button class="action-btn map-btn" onclick="window.open('https://integratedintelligencemap.netlify.app/', '_blank')">
                    🗺️ Explore A Visual Map of Species Intelligence
                </button>
            </div>
            
            <div style="margin-top: 20px;">
                <div id="usageDisplay" style="color: #47485f; font-size: 14px; font-weight: 500;"></div>
            </div>
        </section>
        
        <div id="constellationContainer" class="constellation-container glass" style="display: none;">
            <canvas id="constellationCanvas" width="100%" height="500"></canvas>
        </div>
        
        <div id="results"></div>
        
        <!-- Simplified Footer -->
        <footer class="footer glass">
            <h3>Species Intelligence Research Agent</h3>
            <p>Revolutionary consciousness research platform<br>
            Part of the Generation of Harmony, Intuitive Learning Foundation consciousness research initiative</p>
            
            <div style="margin: 20px 0;">
                <a href="#" onclick="alert('About section coming soon!'); return false;" style="color: #6f9a4c; text-decoration: none; font-weight: 600;">
                    📚 About This Research Platform
                </a>
            </div>
            
            <div class="footer-links">
                <span>Visit:</span>
                <a href="https://intuitivelearningfoundation.org" target="_blank">intuitivelearningfoundation.org</a>
                <span>•</span>
                <a href="https://generateharmony.com" target="_blank">generateharmony.com</a>
                <span>•</span>
                <a href="https://kerrilake.com" target="_blank">kerrilake.com</a>
            </div>
        </footer>
    </div>
    
    <!-- Community Contribution Modal -->
    <div id="contributionModal" class="modal">
        <div class="modal-content glass">
            <span style="position: absolute; right: 20px; top: 15px; font-size: 28px; font-weight: bold; cursor: pointer; color: #47485f;" onclick="closeContributionModal()">&times;</span>
            <h3 style="color: #47485f; font-weight: 600;">Contribute Species Intelligence Knowledge</h3>
            <p style="color: #3e3a44;">Share your research, observations, or insights about species intelligence</p>
            
            <div id="contributionForm">
                <div class="form-group">
                    <label for="contributorName">Your Name/Organization *:</label>
                    <input type="text" id="contributorName" required>
                </div>
                
                <div class="form-group">
                    <label for="contributorEmail">Email (for verification) *:</label>
                    <input type="email" id="contributorEmail" required>
                </div>
                
                <div class="form-group">
                    <label for="speciesName">Species Name *:</label>
                    <input type="text" id="speciesName" required>
                </div>
                
                <div class="form-group">
                    <label for="wisdomInsight">Key Wisdom Insight *:</label>
                    <textarea id="wisdomInsight" rows="3" required placeholder="What profound insight about this species' intelligence should people know?"></textarea>
                </div>
                
                <button onclick="submitContribution()" style="background: linear-gradient(135deg, #6f9a4c, #4e6440); color: white; border: none; padding: 15px 30px; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: 600; width: 100%; margin-top: 20px; font-family: 'Poppins', sans-serif;">Submit Contribution</button>
            </div>
        </div>
    </div>
    
    <!-- Intelligence Mapping Modal -->
    <div id="mappingModal" class="modal">
        <div class="modal-content glass" style="max-width: 900px;">
            <span style="position: absolute; right: 20px; top: 15px; font-size: 28px; font-weight: bold; cursor: pointer; color: #47485f;" onclick="closeMappingModal()">&times;</span>
            <div id="mappingContent"></div>
        </div>
    </div>

    <!-- Include your species-research.js file here -->
    <script src="species-research.js"></script>
    
    <!-- Include the main application JavaScript -->
    <script>
        console.log('🚀 Starting Species Intelligence Research Agent...');
        
        // Global variable to store current PDF data
        let currentPDFData = null;
        
        // Update usage display on load
        document.addEventListener('DOMContentLoaded', function() {
            updateUsageDisplay();
        });
        
        function updateUsageDisplay() {
            const usageDisplay = document.getElementById('usageDisplay');
            if (usageDisplay) {
                // Using your specified limits
                usageDisplay.innerHTML = `Daily research limit: 10 searches | Monthly budget: $100`;
            }
        }
        
        // Modal functions
        function showContributionForm() {
            document.getElementById('contributionModal').style.display = 'block';
        }
        
        function closeContributionModal() {
            document.getElementById('contributionModal').style.display = 'none';
        }
        
        function submitContribution() {
            alert('Thank you! Your contribution has been submitted for review.');
            closeContributionModal();
        }
        
        function closeMappingModal() {
            document.getElementById('mappingModal').style.display = 'none';
        }
        
        // Close modals when clicking outside
        window.onclick = function(event) {
            const contributionModal = document.getElementById('contributionModal');
            const mappingModal = document.getElementById('mappingModal');
            
            if (event.target === contributionModal) {
                closeContributionModal();
            }
            if (event.target === mappingModal) {
                closeMappingModal();
            }
        }
        
        // Add enter key support for species inputs
        document.querySelectorAll('.species-input').forEach(input => {
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    conductResearch();
                }
            });
        });

// This connects your UI to the species-research.js functions

// Configuration
const CONFIG = {
    DAILY_SEARCH_LIMIT: 10,
    MONTHLY_BUDGET: 100,
    COST_PER_SEARCH: 0.50
};

// Global state
let currentSpeciesData = [];
let researchHistory = JSON.parse(localStorage.getItem('researchHistory') || '[]');
let dailyUsage = JSON.parse(localStorage.getItem('dailyUsage') || '{}');
let monthlySpend = parseFloat(localStorage.getItem('monthlySpend') || '0');

// Main research function
async function conductResearch() {
    console.log('🔬 Starting AI-powered research...');
    
    const speciesInputs = [
        document.getElementById('species1').value.trim(),
        document.getElementById('species2').value.trim(),
        document.getElementById('species3').value.trim(),
        document.getElementById('species4').value.trim(),
        document.getElementById('species5').value.trim()
    ].filter(species => species.length > 0);
    
    if (speciesInputs.length === 0) {
        alert('Please enter at least one species name');
        return;
    }
    
    // Check daily limit
    const today = new Date().toDateString();
    if (!dailyUsage[today]) dailyUsage[today] = 0;
    
    if (dailyUsage[today] >= CONFIG.DAILY_SEARCH_LIMIT) {
        alert(`Daily search limit reached (${CONFIG.DAILY_SEARCH_LIMIT} searches). Please try again tomorrow.`);
        return;
    }
    
    // Get options
    const options = {
        includeIndigenous: document.getElementById('includeIndigenous').checked,
        includeBiomimicry: document.getElementById('includeBiomimicry').checked,
        includeHuman: document.getElementById('includeHuman').checked
    };
    
    if (options.includeHuman && !speciesInputs.includes('Human')) {
        speciesInputs.push('Human');
    }
    
    const resultsDiv = document.getElementById('results');
    currentSpeciesData = []; // Reset current data
    
    try {
        // Show loading with DNA animation
        resultsDiv.innerHTML = `
            <div class="results-container glass fade-in">
                <div class="loading-enhanced">
                    <div class="research-animation">🧬</div>
                    <h3 style="color: #47485f;">Conducting Deep Species Intelligence Research</h3>
                    <p style="color: #3e3a44;">Enhanced quantum-consciousness analysis across ${speciesInputs.length} species</p>
                    <p style="color: #6f9a4c; font-size: 14px; margin-top: 10px;">Integrating indigenous wisdom, quantum biology, and unified physics...</p>
                </div>
            </div>
        `;
        
        // Research each species
        const researchResults = [];
        for (let i = 0; i < speciesInputs.length; i++) {
            const species = speciesInputs[i];
            console.log(`🔍 Researching ${i + 1}/${speciesInputs.length}: ${species}`);
            
            // Update loading message
            resultsDiv.innerHTML = `
                <div class="results-container glass fade-in">
                    <div class="loading-enhanced">
                        <div class="research-animation">🧬</div>
                        <h3 style="color: #47485f;">Researching ${species}...</h3>
                        <p style="color: #3e3a44;">Species ${i + 1} of ${speciesInputs.length}</p>
                        <div style="background: rgba(111, 154, 76, 0.2); padding: 10px; border-radius: 10px; margin: 20px auto; max-width: 400px;">
                            <div style="width: ${((i + 1)/speciesInputs.length)*100}%; height: 6px; background: linear-gradient(135deg, #6f9a4c, #4e6440); border-radius: 3px; transition: width 0.5s ease;"></div>
                        </div>
                        <p style="color: #6f9a4c; font-size: 13px;">Accessing consciousness research databases...</p>
                    </div>
                </div>
            `;
            
            // Call the API
            const result = await callAnthropicAPI(species, options);
            researchResults.push(result);
            console.log(`✅ Research completed for ${species}`);
        }
        
        // Update usage
        dailyUsage[today]++;
        localStorage.setItem('dailyUsage', JSON.stringify(dailyUsage));
        
        // Store results
        currentSpeciesData = researchResults;
        
        // Display results
        displayEnhancedResults(researchResults);
        
        // Update usage display
        updateUsageDisplay();
        
        console.log('✅ All research completed successfully');
        
    } catch (error) {
        console.error('❌ Research failed:', error);
        resultsDiv.innerHTML = `
            <div class="results-container glass fade-in">
                <div style="text-align: center; padding: 40px;">
                    <h3 style="color: #47485f;">Research Temporarily Unavailable</h3>
                    <p style="color: #3e3a44;">Error: ${error.message}</p>
                    <button onclick="conductResearch()" class="action-btn research-btn" style="margin: 20px auto;">
                        Try Again
                    </button>
                </div>
            </div>
        `;
    }
}

// Display the research results
function displayEnhancedResults(dataArray) {
    const resultsDiv = document.getElementById('results');
    
    // Prepare PDF data for the first species (or modify to handle multiple)
    if (dataArray.length > 0) {
        const firstSpecies = dataArray[0];
        
        // Format the content for PDF
        currentPDFData = {
            species: firstSpecies.species,
            introduction: `This comprehensive research explores ${firstSpecies.species} through the revolutionary Perceive/Relate/Apply framework with enhanced intelligence dimensions. The research reveals sophisticated temporal awareness, energetic intelligence, collective wisdom, and adaptive strategies that challenge traditional views of intelligence.`,
            keyWisdom: firstSpecies.wisdomInsight || firstSpecies.keyWisdom,
            perceive: `${firstSpecies.perceive.summary}\n${firstSpecies.perceive.details.map(d => `• ${d}`).join('\n')}`,
            relate: `${firstSpecies.relate.summary}\n${firstSpecies.relate.details.map(d => `• ${d}`).join('\n')}`,
            apply: `${firstSpecies.apply.summary}\n${firstSpecies.apply.details.map(d => `• ${d}`).join('\n')}`,
            temporal: firstSpecies.temporalIntelligence,
            energetic: firstSpecies.energeticIntelligence,
            collective: firstSpecies.collectiveWisdom,
            adaptive: firstSpecies.adaptiveStrategies,
            quantum: firstSpecies.quantumAspects,
            humanLearning: firstSpecies.humanLearnings,
            conservation: firstSpecies.conservationWisdom,
            sources: firstSpecies.sources || [
                "Anthropic Claude AI Enhanced Research",
                "Intuitive Learning Foundation Framework",
                "Quantum Biology Research Database",
                "Indigenous Knowledge Systems",
                "Contemporary Consciousness Studies"
            ]
        };
    }
    
    let html = '<div class="fade-in">';
    
    // Display each species result
    dataArray.forEach((data, index) => {
        const fallbackNote = data.researchBacked === false ? 
            '<p style="background: rgba(231, 198, 77, 0.2); padding: 10px; border-radius: 8px; margin: 10px 0; font-size: 0.9em; text-align: center;">Note: This is enhanced framework data provided when live research is temporarily unavailable.</p>' : '';
        
        html += `
            <div class="results-container glass">
                <div class="species-header">
                    <h2>${data.species}</h2>
                    <div class="research-type">
                        ${data.researchBacked ? '🔬 Quantum-Enhanced AI Research' : '📋 Enhanced Framework Analysis'}
                    </div>
                </div>
                
                ${fallbackNote}
                
                <div class="wisdom-insight">
                    <h3>💡 Key Wisdom</h3>
                    <p>${data.wisdomInsight}</p>
                </div>
                
                <div class="intelligence-framework">
                    <div class="framework-section perceive-section">
                        <h3><span class="framework-badge">PERCEIVE</span> How They Perceive</h3>
                        <p>${data.perceive.summary}</p>
                        <ul class="framework-details">
                            ${data.perceive.details.map(detail => `<li>${detail}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="framework-section relate-section">
                        <h3><span class="framework-badge">RELATE</span> How They Relate</h3>
                        <p>${data.relate.summary}</p>
                        <ul class="framework-details">
                            ${data.relate.details.map(detail => `<li>${detail}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="framework-section apply-section">
                        <h3><span class="framework-badge">APPLY</span> How They Apply Intelligence</h3>
                        <p>${data.apply.summary}</p>
                        <ul class="framework-details">
                            ${data.apply.details.map(detail => `<li>${detail}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                
                <div class="wisdom-insight temporal-dimension">
                    <h3>⏰ Temporal Intelligence</h3>
                    <p>${data.temporalIntelligence}</p>
                </div>
                
                <div class="wisdom-insight energetic-dimension">
                    <h3>⚡ Energetic Intelligence</h3>
                    <p>${data.energeticIntelligence}</p>
                </div>
                
                <div class="wisdom-insight collective-dimension">
                    <h3>🤝 Collective Wisdom</h3>
                    <p>${data.collectiveWisdom}</p>
                </div>
                
                <div class="wisdom-insight adaptive-dimension">
                    <h3>🔄 Adaptive Strategies</h3>
                    <p>${data.adaptiveStrategies}</p>
                </div>
                
                <div class="wisdom-insight enhanced-dimension">
                    <h3>🌌 Quantum Biology & Consciousness</h3>
                    <p>${data.quantumAspects}</p>
                </div>
                
                <div class="wisdom-insight enhanced-dimension">
                    <h3>🌱 Human Learning Opportunities</h3>
                    <p>${data.humanLearnings}</p>
                </div>
                
                <div class="wisdom-insight enhanced-dimension">
                    <h3>🌍 Conservation Intelligence</h3>
                    <p>${data.conservationWisdom}</p>
                </div>
            </div>
        `;
    });
    
    // Action buttons after all results
    html += `
        <div class="results-container glass">
            <div class="action-buttons" style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin: 30px 0;">
                <button class="action-btn" onclick="generatePDFReport(currentPDFData)" style="background: linear-gradient(135deg, #47485f, #3e3a44); color: white; padding: 15px 30px; border-radius: 25px;">
                    📄 Download PDF Report
                </button>
                <button class="action-btn" onclick="resetSearch()" style="background: linear-gradient(135deg, #9daaec, #634e87); color: white; padding: 15px 30px; border-radius: 25px;">
                    🔍 Research More Species
                </button>
            </div>
            <div style="text-align: center; margin-top: 20px; padding: 15px; background: rgba(111, 154, 76, 0.1); border-radius: 10px;">
                <small style="color: #47485f; font-size: 12px;">
                    Enhanced research with 7 intelligence dimensions • 
                    ${dataArray.reduce((sum, d) => sum + (d.sources?.length || 0), 0)} sources consulted • 
                    Quantum biology integrated
                </small>
            </div>
        </div>
    `;
    
    html += '</div>';
    resultsDiv.innerHTML = html;
}

// COMPLETE ENHANCED generatePDFReport FUNCTION WITH UNSPECIATED LOGO
function generatePDFReport(report) {
    // Check if report data exists
    if (!report) {
        alert('No research data available. Please conduct research first.');
        return;
    }
    
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({
        orientation: 'portrait',
        unit: 'pt',
        format: 'letter'
    });

    // ILF Color palette
    const colors = {
        primaryGreen: [111, 154, 76],
        primaryGold: [231, 199, 77],
        primaryPurple: [71, 72, 95],
        secondaryPurple: [99, 78, 135],
        lightGray: [102, 102, 102],
        darkGray: [62, 58, 68],
        white: [255, 255, 255],
        panelBg: [248, 250, 255],
        lightPanelBg: [245, 248, 255]
    };

    let yPosition = 40;
    const margin = 40;
    const pageWidth = doc.internal.pageSize.width;
    const contentWidth = pageWidth - (margin * 2);
    const lineHeight = 14;

    // Helper function to add panel backgrounds
    function addPanel(y, height, isGradient = false) {
        if (isGradient) {
            // Subtle gradient effect with two tones
            doc.setFillColor(245, 248, 255);
            doc.roundedRect(margin - 10, y - 10, contentWidth + 20, height + 20, 10, 10, 'F');
            doc.setFillColor(248, 250, 255);
            doc.roundedRect(margin - 5, y - 5, contentWidth + 10, height + 10, 8, 8, 'F');
        } else {
            doc.setFillColor(...colors.panelBg);
            doc.roundedRect(margin - 10, y - 10, contentWidth + 20, height + 20, 10, 10, 'F');
        }
    }

// Helper function to add gradient line
function addGradientLine(x, y, width) {
    doc.setDrawColor(...colors.primaryGreen);
    doc.setLineWidth(3);
    doc.line(x, y, x + width/3, y);
    doc.setDrawColor(...colors.primaryGold);
    doc.line(x + width/3, y, x + 2*width/3, y);
    doc.setDrawColor(...colors.primaryPurple);
    doc.line(x + 2*width/3, y, x + width, y);
}

    // Helper function to add colored header panel
    function addColoredHeader(y, height, color1, color2) {
    // Simulate gradient with overlapping shapes
    doc.setFillColor(...color1);
    doc.roundedRect(margin - 10, y - 10, contentWidth + 20, height + 20, 10, 10, 'F');
    doc.setFillColor(...color2);
    doc.roundedRect(margin + contentWidth/2, y - 10, contentWidth/2 - 10, height + 20, 10, 10, 'F');
}

    // Helper function to check page break
    function checkPageBreak(neededSpace) {
        if (yPosition + neededSpace > doc.internal.pageSize.height - 60) {
            doc.addPage();
            yPosition = 40;
            return true;
        }
        return false;
    }

    // Helper function to add page number
    function addPageNumber(pageNum) {
        doc.setFont('helvetica', 'normal');
        doc.setFontSize(10);
        doc.setTextColor(...colors.lightGray);
        doc.text(pageNum.toString(), pageWidth - margin, doc.internal.pageSize.height - 30);
    }

    // PAGE 1: TITLE PAGE
    // Unspeciated Logo
    yPosition = 80;
    const logoUrl = 'https://images.squarespace-cdn.com/content/6404d194cd10dd208e6bcde9/49bc47d7-006d-4c53-9400-b3fc684b02d2/Unspeciated+logo+round+trspbknd.png?content-type=image%2Fpng';
    
    try {
        doc.addImage(logoUrl, 'PNG', pageWidth/2 - 90, yPosition, 180, 180);
    } catch (error) {
        console.error('Logo loading failed:', error);
        // Fallback to placeholder if logo fails to load
        doc.setFillColor(...colors.lightPanelBg);
        doc.circle(pageWidth/2, yPosition + 90, 90, 'F');
        doc.setFont('helvetica', 'normal');
        doc.setFontSize(12);
        doc.setTextColor(...colors.primaryPurple);
        doc.text('[Logo]', pageWidth/2, yPosition + 90, { align: 'center' });
    }
    
    yPosition += 220;

    // Title
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(36);
    doc.setTextColor(...colors.primaryPurple);
    doc.text('Unspeciated: Redefining Intelligence', pageWidth/2, yPosition, { align: 'center' });
    
    yPosition += 50;
    doc.setFontSize(32);
    doc.text('Research', pageWidth/2, yPosition, { align: 'center' });
    
    // Subtitle
    yPosition += 40;
    doc.setFont('helvetica', 'normal');
    doc.setFontSize(18);
    doc.setTextColor(...colors.secondaryPurple);
    doc.text('Perceive • Relate • Apply Framework with Enhanced Dimensions', pageWidth/2, yPosition, { align: 'center' });
    
    // Gradient line
    yPosition += 40;
    addGradientLine(pageWidth/2 - 60, yPosition, 120);
    
    // Meta info panel
    yPosition += 40;
    addPanel(yPosition, 100, true);
    
    doc.setFont('helvetica', 'normal');
    doc.setFontSize(14);
    doc.setTextColor(...colors.primaryPurple);
    const speciesText = `Research Focus: ${report.species}`;
    doc.text(speciesText, pageWidth/2, yPosition + 20, { align: 'center' });
    
    doc.setFontSize(13);
    doc.setTextColor(...colors.lightGray);
    doc.text(`Generated: ${new Date().toLocaleDateString()}`, pageWidth/2, yPosition + 45, { align: 'center' });
    
    doc.setTextColor(...colors.secondaryPurple);
    doc.text('Powered by Claude AI & Intuitive Learning Foundation Framework', pageWidth/2, yPosition + 70, { align: 'center' });
    
    // Footer
    yPosition = doc.internal.pageSize.height - 120;
    addPanel(yPosition, 60, true);
    
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(16);
    doc.setTextColor(...colors.primaryPurple);
    doc.text('Generation of Harmony LLC', pageWidth/2, yPosition + 20, { align: 'center' });
    
    doc.setFont('helvetica', 'normal');
    doc.setFontSize(12);
    doc.setTextColor(...colors.lightGray);
    doc.text('intuitivelearningfoundation.org • generateharmony.com • kerrilake.com', pageWidth/2, yPosition + 40, { align: 'center' });

    // PAGE 2: KEY WISDOM INSIGHTS + SPECIES PROFILE START
    doc.addPage();
    yPosition = 40;
    
    // Key Wisdom Insights
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(28);
    doc.setTextColor(...colors.primaryGreen);
    doc.text('Key Wisdom Insights', margin, yPosition);
    
    yPosition += 40;
    
    // Key insights panel
    const introHeight = 120; // Approximate height
    addPanel(yPosition, introHeight, true);
    
    doc.setFont('helvetica', 'normal');
    doc.setFontSize(14);
    doc.setTextColor(...colors.darkGray);
    const introLines = doc.splitTextToSize(report.introduction || 
        "This research explores consciousness through the revolutionary Perceive/Relate/Apply framework.", 
        contentWidth - 20);
    doc.text(introLines, margin + 10, yPosition + 20);
    
    yPosition += introHeight + 40;
    
    // Species header
    addColoredHeader(yPosition, 70, colors.primaryGreen, colors.secondaryPurple);
    
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(30);
    doc.setTextColor(...colors.white);
    doc.text(`${report.species} Intelligence Profile`, margin + 10, yPosition + 30);
    
    doc.setFont('helvetica', 'italic');
    doc.setFontSize(13);
    doc.text('AI-Enhanced Research', margin + 10, yPosition + 50);
    
    yPosition += 90;
    
    // Key Wisdom panel
    const wisdomHeight = Math.max(80, report.keyWisdom ? doc.splitTextToSize(report.keyWisdom, contentWidth - 20).length * lineHeight + 40 : 80);
    addPanel(yPosition, wisdomHeight);
    
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(18);
    doc.setTextColor(...colors.primaryPurple);
    doc.text('Key Wisdom Insight', margin + 10, yPosition + 20);
    
    if (report.keyWisdom) {
        doc.setFont('helvetica', 'normal');
        doc.setFontSize(14);
        doc.setTextColor(...colors.darkGray);
        const wisdomLines = doc.splitTextToSize(report.keyWisdom, contentWidth - 20);
        doc.text(wisdomLines, margin + 10, yPosition + 45);
    }
    
    addPageNumber(2);

    // PAGE 3: PERCEIVE, RELATE, APPLY
    doc.addPage();
    yPosition = 40;
    
    // Framework sections
    const frameworkSections = [
        { title: 'PERCEIVE • How They Perceive Their World', content: report.perceive },
        { title: 'RELATE • How They Relate To Their World', content: report.relate },
        { title: 'APPLY • How They Apply Their Intelligence', content: report.apply }
    ];
    
    frameworkSections.forEach((section, index) => {
        checkPageBreak(200);
        
        // Calculate height needed
        const textLines = section.content ? doc.splitTextToSize(section.content.split('\n')[0], contentWidth - 30) : [];
        const bulletPoints = section.content ? section.content.split('\n').slice(1).filter(line => line.trim().startsWith('•')) : [];
        const sectionHeight = textLines.length * lineHeight + bulletPoints.length * 18 + 60;
        
        addPanel(yPosition, sectionHeight);
        
        // Section title with dot
        doc.setFillColor(...colors.primaryGold);
        doc.circle(margin + 5, yPosition + 15, 5, 'F');
        
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(14);
        doc.setTextColor(...colors.secondaryPurple);
        doc.text(section.title, margin + 20, yPosition + 20);
        
        yPosition += 35;
        
        // Content
        if (section.content) {
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(14);
            doc.setTextColor(...colors.darkGray);
            
            const parts = section.content.split('\n');
            const mainText = parts[0];
            const mainLines = doc.splitTextToSize(mainText, contentWidth - 30);
            doc.text(mainLines, margin + 10, yPosition);
            yPosition += mainLines.length * lineHeight + 10;
            
            // Bullet points
            parts.slice(1).forEach(line => {
                if (line.trim().startsWith('•')) {
                    doc.setFillColor(...colors.primaryGold);
                    doc.circle(margin + 15, yPosition - 3, 3, 'F');
                    
                    doc.setTextColor(...colors.darkGray);
                    const bulletText = line.replace('•', '').trim();
                    const bulletLines = doc.splitTextToSize(bulletText, contentWidth - 40);
                    doc.text(bulletLines, margin + 25, yPosition);
                    yPosition += bulletLines.length * lineHeight + 4;
                }
            });
        }
        
        yPosition += 20;
    });
    
    addPageNumber(3);

    // PAGE 4+: ENHANCED DIMENSIONS
    doc.addPage();
    yPosition = 40;
    let pageNum = 4;
    
    const dimensions = [
        { num: '1', title: 'Temporal Intelligence', content: report.temporal },
        { num: '2', title: 'Energetic Intelligence', content: report.energetic },
        { num: '3', title: 'Collective Wisdom', content: report.collective },
        { num: '4', title: 'Adaptive Strategies', content: report.adaptive },
        { num: '5', title: 'Quantum Biology & Consciousness', content: report.quantum },
        { num: '6', title: 'Human Learning Opportunities', content: report.humanLearning },
        { num: '7', title: 'Conservation Intelligence', content: report.conservation }
    ];
    
    dimensions.forEach((dim, index) => {
        if (dim.content) {
            const contentLines = doc.splitTextToSize(dim.content, contentWidth - 30);
            const neededHeight = contentLines.length * lineHeight + 60;
            
            if (checkPageBreak(neededHeight)) {
                pageNum++;
            }
            
            // Number circle
            doc.setFillColor(...colors.primaryGold);
            doc.circle(margin + 15, yPosition + 15, 15, 'F');
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(14);
            doc.setTextColor(...colors.white);
            doc.text(dim.num, margin + 15, yPosition + 20, { align: 'center' });
            
            // Title
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(18);
            doc.setTextColor(...colors.primaryPurple);
            doc.text(dim.title, margin + 40, yPosition + 20);
            
            yPosition += 35;
            
            // Content panel with alternating colors
            const panelHeight = contentLines.length * lineHeight + 20;
            addPanel(yPosition, panelHeight);
            
            // Add colored left border
            if (index % 2 === 0) {
                doc.setFillColor(...colors.primaryGreen);
            } else {
                doc.setFillColor(...colors.primaryGold);
            }
            doc.rect(margin - 10, yPosition - 10, 4, panelHeight + 20, 'F');
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(14);
            doc.setTextColor(...colors.darkGray);
            doc.text(contentLines, margin + 10, yPosition + 10);
            
            yPosition += panelHeight + 30;
        }
    });
    
    addPageNumber(pageNum);

    // SOURCES PAGE
    doc.addPage();
    yPosition = 40;
    pageNum++;
    
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(28);
    doc.setTextColor(...colors.primaryGreen);
    doc.text('Sources and References', margin, yPosition);
    
    yPosition += 30;
    addGradientLine(margin, yPosition, 80);
    yPosition += 30;
    
    // Sources panel
    const sourcesHeight = report.sources ? report.sources.length * 20 + 60 : 100;
    addPanel(yPosition, sourcesHeight);
    
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(14);
    doc.setTextColor(...colors.primaryGreen);
    doc.text(`${report.species} Research Sources:`, margin + 10, yPosition + 20);
    
    yPosition += 40;
    
    if (report.sources && report.sources.length > 0) {
        doc.setFont('helvetica', 'normal');
        doc.setFontSize(12);
        doc.setTextColor(...colors.darkGray);
        
        report.sources.forEach((source, index) => {
            doc.text(`${index + 1}. ${source}`, margin + 20, yPosition);
            yPosition += 20;
        });
    }
    
    // Final footer
    yPosition = doc.internal.pageSize.height - 100;
    addPanel(yPosition, 70, true);
    
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(14);
    doc.setTextColor(...colors.primaryPurple);
    doc.text('Generated by Species Intelligence Research Agent', pageWidth/2, yPosition + 20, { align: 'center' });
    doc.text('Generation of Harmony LLC', pageWidth/2, yPosition + 40, { align: 'center' });
    
    doc.setFont('helvetica', 'normal');
    doc.setFontSize(11);
    doc.setTextColor(...colors.lightGray);
    doc.text('Visit: intuitivelearningfoundation.org • generateharmony.com • kerrilake.com', pageWidth/2, yPosition + 55, { align: 'center' });
    
    addPageNumber(pageNum);

    // Save the PDF
    doc.save(`${report.species}_intelligence_research.pdf`);
}

// Reset search
function resetSearch() {
    document.getElementById('species1').value = '';
    document.getElementById('species2').value = '';
    document.getElementById('species3').value = '';
    document.getElementById('species4').value = '';
    document.getElementById('species5').value = '';
    document.getElementById('includeIndigenous').checked = false;
    document.getElementById('includeBiomimicry').checked = false;
    document.getElementById('includeHuman').checked = false;
    document.getElementById('results').innerHTML = '';
    document.getElementById('species1').focus();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// Update usage display
function updateUsageDisplay() {
    const today = new Date().toDateString();
    const todayUsage = dailyUsage[today] || 0;
    const remaining = CONFIG.DAILY_SEARCH_LIMIT - todayUsage;
    
    document.getElementById('usageDisplay').innerHTML = 
        `Searches today: ${todayUsage}/${CONFIG.DAILY_SEARCH_LIMIT} • Remaining: ${remaining} • Monthly budget: $${CONFIG.MONTHLY_BUDGET}`;
}
    </script>
</body>
</html>
